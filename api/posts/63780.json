{"title":"python 爬取网站的小说","slug":"python爬取网站的小说","date":"2020-10-03","updated":"2020-10-03","comments":true,"path":"api/posts/63780.json","excerpt":null,"cover":"https://s1.ax1x.com/2020/10/03/034SHA.png","covers":["https://s1.ax1x.com/2020/10/03/034SHA.png"],"content":"<h3 id=\"截图\"><a href=\"# 截图\" class=\"headerlink\" title=\"截图\"></a> 截图 </h3><p><img src=\"https://s1.ax1x.com/2020/10/03/034SHA.png\" alt=\"034SHA.png\"><br><img src=\"https://s1.ax1x.com/2020/10/03/034k38.png\" alt=\"034k38.png\"></p>\n<h3 id=\"源代码\"><a href=\"# 源代码\" class=\"headerlink\" title=\"源代码\"></a> 源代码 </h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># re 是正则表达式 </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 要爬取的小说 url</span></span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://www.shujy.com/5200/244309/&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">response = requests.get(url)</span><br><span class=\"line\"></span><br><span class=\"line\">response.encoding=<span class=\"string\">&#x27;utf-8&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">html = response.text</span><br><span class=\"line\"></span><br><span class=\"line\">print(html)</span><br><span class=\"line\"></span><br><span class=\"line\">print(<span class=\"string\">&#x27;*&#x27;</span>*<span class=\"number\">100</span>)</span><br><span class=\"line\"><span class=\"comment\"># 小说标题   正则表达式匹配 </span></span><br><span class=\"line\">title=re.findall(<span class=\"string\">r&#x27;&lt;meta property=&quot;og:novel:book_name&quot; content=&quot;(.*?)&quot;/&gt;&#x27;</span>,html)[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">print(title)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个 txt 文件来保存小说内容   与该 py 文件在同一目录中 </span></span><br><span class=\"line\"></span><br><span class=\"line\">fb = open(<span class=\"string\">&#x27;%s.txt&#x27;</span>% title,<span class=\"string\">&#x27;w&#x27;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 小说的章节目标都在标签 &lt;div id=&#x27;list&#x27;&gt; 里我们通过下面的代码获取对应的章节名和 url。用一个 list 来存放章节信息。</span></span><br><span class=\"line\">dl=re.findall(<span class=\"string\">r&#x27;&lt;div id=&quot;list&quot;&gt;.*?&lt;/div&gt;&#x27;</span>,html,re.S)[<span class=\"number\">0</span>]</span><br><span class=\"line\">chapter_info_list=re.findall(<span class=\"string\">r&#x27;&lt;a href=&quot;(.*?)&quot;&gt;(.*?)&lt;/a&gt;&#x27;</span>,dl)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(<span class=\"string\">&quot;*&quot;</span>*<span class=\"number\">100</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot; 获取章节列表 &quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 循环每一章节，分别下载，先把章节的链接，章节名提取出来。</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> chapter_info <span class=\"keyword\">in</span>  chapter_info_list:</span><br><span class=\"line\">    chapter_url,chapter_title = chapter_info</span><br><span class=\"line\">    chapter_url = <span class=\"string\">&quot;http://www.shujy.com/5200/244309/%s&quot;</span> % chapter_url</span><br><span class=\"line\">    chapter_url = chapter_url.replace(<span class=\"string\">&#x27; &#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    print(chapter_url)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 下载小说内容 </span></span><br><span class=\"line\">    chapter_response = requests.get(chapter_url)</span><br><span class=\"line\">    chapter_response.encoding=<span class=\"string\">&#x27;utf-8&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\"># print(chapter_response.text)</span></span><br><span class=\"line\">    chapter_html = chapter_response.text</span><br><span class=\"line\">    <span class=\"comment\"># 小说的具体内容是在标签 &lt;div id=content&gt; 里，和获取小说章节一样我们采用正则表达式来取得小说的内容。</span></span><br><span class=\"line\">    chapter_content = re.findall(<span class=\"string\">r&#x27;&lt;div id=&quot;content&quot;&gt;(.*?)&lt;/div&gt;&#x27;</span>,chapter_html,re.S)[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"comment\"># 这时候的 chaper_content 的内容还包含 &lt;br&gt;，&amp;nbsp 等标签 </span></span><br><span class=\"line\">    <span class=\"comment\"># print(chapter_content)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 做数据的清洗 </span></span><br><span class=\"line\">    chapter_content = chapter_content.replace(<span class=\"string\">&#x27;&amp;nbsp;&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    chapter_content = chapter_content.replace(<span class=\"string\">&#x27;&lt;br /&gt;&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    chapter_content = chapter_content.replace(<span class=\"string\">&#x27;&amp;amp;t&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    chapter_content = chapter_content.replace(<span class=\"string\">&#x27;&amp;emsp;&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    chapter_content = chapter_content.replace(<span class=\"string\">&#x27;&amp;t;&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    chapter_content = chapter_content.replace(<span class=\"string\">&#x27;\\n&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 数据清洗后的内容   是纯文本了 </span></span><br><span class=\"line\">    print(chapter_content)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#     把小说保存到 txt 中 </span></span><br><span class=\"line\">    fb.write(chapter_title)</span><br><span class=\"line\">    fb.write(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    fb.write(chapter_content)</span><br><span class=\"line\">    fb.write(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    print(chapter_url,chapter_title)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","url":"/posts/63780/","min2read":2,"word4post":480,"prev_post":{"title":"Python 中文分词及词频统计","url":"/posts/34275/"},"next_post":{"title":"python 爬取网站的小说 2","url":"/posts/7481/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"截图\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\"> 截图 </span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"源代码\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\"> 源代码 </span></a></li></ol>","categories":[{"name":"python","path":"api/categories/python.json","url":"/categories/python/"},{"name":"爬虫","path":"api/categories/爬虫.json","url":"/categories/爬虫/"}],"tags":[{"name":"python","path":"api/tags/python.json","url":"/tags/python/"},{"name":"小说","path":"api/tags/小说.json","url":"/tags/小说/"}]}